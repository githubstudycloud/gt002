# Claude Relay Service å†…ç½‘éƒ¨ç½²é¡¹ç›®è¯´æ˜

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å·²å®Œæˆ Claude Relay Service çš„å†…ç½‘éƒ¨ç½²ä¼˜åŒ–ï¼ŒåŒ…æ‹¬ï¼š

1. âœ… Docker Compose é…ç½®é€‚é…å†…ç½‘ç¯å¢ƒ
2. âœ… é•œåƒæ„å»ºå’Œåˆ†å·è„šæœ¬ï¼ˆé€‚åˆ Git ä¸Šä¼ é™åˆ¶ï¼‰
3. âœ… ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆLinux/macOS/Windowsï¼‰
4. âœ… å®Œæ•´çš„éƒ¨ç½²æ–‡æ¡£å’Œå¿«é€Ÿå¼€å§‹æŒ‡å—
5. âœ… æ•°æ®æŒä¹…åŒ–é…ç½®ï¼ˆæ˜ å°„åˆ°ä¸»æœºç›®å½•ï¼‰

## é¡¹ç›®ä½ç½®

```
e:\claudecode\github002\claude-relay-service\
```

## æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### Docker é…ç½®

- `docker-compose.yml` - å†…ç½‘éƒ¨ç½²ç‰ˆæœ¬ï¼ˆä¸»é…ç½®ï¼‰
- `docker-compose.official.yml` - å®˜æ–¹åŸå§‹é…ç½®ï¼ˆå¤‡ä»½ï¼‰
- `Dockerfile` - é•œåƒæ„å»ºæ–‡ä»¶
- `docker-entrypoint.sh` - å®¹å™¨å¯åŠ¨è„šæœ¬
- `.env.example` - ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿

### éƒ¨ç½²è„šæœ¬ï¼ˆLinux/macOSï¼‰

- `build.sh` - æ„å»º Docker é•œåƒ
- `export-images.sh` - å¯¼å‡ºé•œåƒå¹¶è‡ªåŠ¨åˆ†å·ï¼ˆ45MB/ä¸ªï¼‰
- `load-images.sh` - åœ¨å†…ç½‘æœåŠ¡å™¨åŠ è½½é•œåƒ
- `init-env.sh` - åˆå§‹åŒ–ç¯å¢ƒå’Œç”Ÿæˆå¯†é’¥
- `deploy.sh` - ç»Ÿä¸€éƒ¨ç½²ç®¡ç†ï¼ˆstart/stop/restart/status/logsï¼‰

### éƒ¨ç½²è„šæœ¬ï¼ˆWindowsï¼‰

- `deploy.bat` - Windows éƒ¨ç½²ç®¡ç†
- `init-env.bat` - Windows ç¯å¢ƒåˆå§‹åŒ–

### æ–‡æ¡£

- `README-INTRANET.md` - å†…ç½‘éƒ¨ç½²ä¸»æ–‡æ¡£ï¼ˆå¿«é€Ÿå‚è€ƒï¼‰
- `README-DEPLOYMENT.md` - å®Œæ•´éƒ¨ç½²æŒ‡å—ï¼ˆè¯¦ç»†è¯´æ˜ï¼‰
- `QUICKSTART.md` - 5 åˆ†é’Ÿå¿«é€Ÿå¼€å§‹
- `PROJECT-SUMMARY.md` - é¡¹ç›®æŠ€æœ¯æ€»ç»“
- `README.md` / `README_EN.md` - å®˜æ–¹åŸå§‹æ–‡æ¡£

### é…ç½®æ–‡ä»¶

- `.gitignore.deployment` - Git å¿½ç•¥è§„åˆ™ï¼ˆé˜²æ­¢æäº¤æ•æ„Ÿä¿¡æ¯ï¼‰

## éƒ¨ç½²æµç¨‹

### å¿«é€Ÿéƒ¨ç½²ï¼ˆæ¨èï¼‰

#### æœ‰å¤–ç½‘ç¯å¢ƒçš„æ„å»ºæœº

```bash
cd claude-relay-service

# 1. æ„å»ºé•œåƒ
./build.sh

# 2. å¯¼å‡ºé•œåƒï¼ˆè‡ªåŠ¨åˆ†å·ï¼‰
./export-images.sh

# 3. æäº¤åˆ° Git
git add images/
git commit -m "Add Docker images"
git push
```

#### å†…ç½‘æœåŠ¡å™¨

```bash
cd claude-relay-service

# 1. åŠ è½½é•œåƒ
./load-images.sh

# 2. åˆå§‹åŒ–ç¯å¢ƒï¼ˆç”Ÿæˆå¯†é’¥ï¼‰
./init-env.sh

# 3. å¯åŠ¨æœåŠ¡
./deploy.sh start

# 4. æŸ¥çœ‹ç®¡ç†å‘˜å‡­æ®
cat ./data/app/init.json
```

è®¿é—®: http://æœåŠ¡å™¨IP:3000/web

### å†…ç½‘ç›´æ¥æ„å»ºï¼ˆéœ€é…ç½®é•œåƒæºï¼‰

```bash
cd claude-relay-service

# 1. åˆå§‹åŒ–ç¯å¢ƒ
./init-env.sh

# 2. å¯åŠ¨æœåŠ¡ï¼ˆè‡ªåŠ¨æ„å»ºï¼‰
./deploy.sh start
```

## æ ¸å¿ƒç‰¹æ€§

### 1. é•œåƒåˆ†å·ç®¡ç†

- è‡ªåŠ¨å°†å¤§é•œåƒåˆ†å‰²ä¸º < 45MB çš„å°æ–‡ä»¶
- ç”Ÿæˆ SHA256 æ ¡éªŒå’Œæ–‡ä»¶
- é€‚åº” Git 50MB æ–‡ä»¶å¤§å°é™åˆ¶
- è‡ªåŠ¨åˆå¹¶å’Œå®Œæ•´æ€§éªŒè¯

### 2. ç¯å¢ƒé…ç½®

è‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹é…ç½®ï¼š

- `JWT_SECRET` - JWT è®¤è¯å¯†é’¥ï¼ˆ48 å­—ç¬¦ï¼‰
- `ENCRYPTION_KEY` - æ•°æ®åŠ å¯†å¯†é’¥ï¼ˆ32 å­—ç¬¦ï¼‰
- `REDIS_PASSWORD` - Redis æ•°æ®åº“å¯†ç ï¼ˆ24 å­—ç¬¦ï¼‰

### 3. æ•°æ®æŒä¹…åŒ–

æ‰€æœ‰æ•°æ®æ˜ å°„åˆ°ä¸»æœºç›®å½•ï¼š

```
./data/
â”œâ”€â”€ logs/      # åº”ç”¨æ—¥å¿—
â”œâ”€â”€ app/       # åº”ç”¨æ•°æ®ï¼ˆè´¦æˆ·ã€API Key ç­‰ï¼‰
â””â”€â”€ redis/     # Redis æ•°æ®åº“æ•°æ®
```

### 4. è·¨å¹³å°æ”¯æŒ

- Linux (bash è„šæœ¬)
- macOS (bash è„šæœ¬)
- Windows (bat è„šæœ¬)

## æŠ€æœ¯äº®ç‚¹

1. **å®Œå…¨ç¦»çº¿éƒ¨ç½²**: é•œåƒé¢„æ„å»ºï¼Œå†…ç½‘æ— éœ€å¤–ç½‘è®¿é—®
2. **ä¸€é”®æ“ä½œ**: æ‰€æœ‰å¤æ‚æ“ä½œå°è£…ä¸ºç®€å•è„šæœ¬
3. **å®‰å…¨æ€§**: è‡ªåŠ¨ç”Ÿæˆå¼ºéšæœºå¯†é’¥ï¼Œç¯å¢ƒå˜é‡éš”ç¦»
4. **å¯ç»´æŠ¤æ€§**: ç»Ÿä¸€æ•°æ®ç›®å½•ï¼Œä¾¿äºå¤‡ä»½å’Œè¿ç§»
5. **Git å‹å¥½**: é•œåƒè‡ªåŠ¨åˆ†å·ï¼Œé€‚åˆç‰ˆæœ¬æ§åˆ¶

## ä½¿ç”¨å»ºè®®

### æœ¬åœ°æµ‹è¯•

å½“å‰åœ¨ Windows ç¯å¢ƒï¼ˆe:\claudecode\github002ï¼‰ï¼Œå»ºè®®ï¼š

1. å…ˆåœ¨æœ¬åœ°æµ‹è¯•æ„å»ºæµç¨‹ï¼ˆå¦‚æœæœ‰ Docker Desktopï¼‰
2. éªŒè¯è„šæœ¬åŠŸèƒ½æ­£å¸¸
3. å‡†å¤‡å¥½åéƒ¨ç½²åˆ°å®é™…æœåŠ¡å™¨

### é€šè¿‡ MCP è¿œç¨‹éƒ¨ç½²

å¦‚æœéœ€è¦é€šè¿‡ MCP åœ¨è¿œç¨‹æœºå™¨ä¸Šéƒ¨ç½²ï¼š

1. ç¡®ä¿è¿œç¨‹æœºå™¨å·²å®‰è£… Docker
2. å°†æ•´ä¸ª `claude-relay-service` ç›®å½•ä¼ è¾“åˆ°è¿œç¨‹æœº
3. åœ¨è¿œç¨‹æœºä¸Šè¿è¡Œéƒ¨ç½²è„šæœ¬

### ç”Ÿäº§ç¯å¢ƒå»ºè®®

1. é…ç½®åå‘ä»£ç†ï¼ˆNginx/Caddyï¼‰
2. å¯ç”¨ HTTPS
3. è®¾ç½®é˜²ç«å¢™è§„åˆ™
4. é…ç½®å®šæœŸå¤‡ä»½
5. ç›‘æ§æœåŠ¡çŠ¶æ€å’Œèµ„æºä½¿ç”¨

## å¸¸ç”¨ç®¡ç†å‘½ä»¤

```bash
# æœåŠ¡ç®¡ç†
./deploy.sh start        # å¯åŠ¨æœåŠ¡
./deploy.sh stop         # åœæ­¢æœåŠ¡
./deploy.sh restart      # é‡å¯æœåŠ¡
./deploy.sh status       # æŸ¥çœ‹çŠ¶æ€
./deploy.sh logs         # æŸ¥çœ‹æ—¥å¿—
./deploy.sh clean        # æ¸…ç†å¹¶é‡å¯

# æ•°æ®å¤‡ä»½
./deploy.sh stop
tar -czf backup-$(date +%Y%m%d).tar.gz ./data
./deploy.sh start

# é•œåƒç®¡ç†
./build.sh               # æ„å»ºé•œåƒ
./export-images.sh       # å¯¼å‡ºé•œåƒ
./load-images.sh         # åŠ è½½é•œåƒ
```

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
./deploy.sh logs

# æ£€æŸ¥ Docker æœåŠ¡
docker ps
docker info

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep 3000
```

### é—®é¢˜ 2: é•œåƒåŠ è½½å¤±è´¥

```bash
# éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
cd images
sha256sum -c checksums.txt

# æ‰‹åŠ¨åˆå¹¶å’ŒåŠ è½½
cat claude-relay-service.tar.gz.part-* > claude-relay-service.tar.gz
docker load < claude-relay-service.tar.gz
```

### é—®é¢˜ 3: æ— æ³•è®¿é—®ç®¡ç†ç•Œé¢

```bash
# æ£€æŸ¥ BIND_HOST é…ç½®
grep BIND_HOST .env

# åº”è¯¥æ˜¯ 0.0.0.0 å…è®¸å¤–éƒ¨è®¿é—®
# å¦‚æœæ˜¯ 127.0.0.1 åˆ™åªèƒ½æœ¬åœ°è®¿é—®

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw allow 3000
```

## æ–‡æ¡£å¯¼èˆª

- å¿«é€Ÿå…¥é—¨: [README-INTRANET.md](../claude-relay-service/README-INTRANET.md)
- å®Œæ•´æŒ‡å—: [README-DEPLOYMENT.md](../claude-relay-service/README-DEPLOYMENT.md)
- å¿«é€Ÿå¼€å§‹: [QUICKSTART.md](../claude-relay-service/QUICKSTART.md)
- æŠ€æœ¯æ€»ç»“: [PROJECT-SUMMARY.md](../claude-relay-service/PROJECT-SUMMARY.md)

## ä¸‹ä¸€æ­¥

### å¦‚æœåœ¨æœ¬åœ°æµ‹è¯•

```bash
cd claude-relay-service

# Windows (éœ€è¦ Docker Desktop)
init-env.bat
deploy.bat start

# WSL/Linux
./init-env.sh
./deploy.sh start
```

### å¦‚æœé€šè¿‡ MCP éƒ¨ç½²åˆ°è¿œç¨‹æœº

éœ€è¦ï¼š
1. é…ç½® MCP è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨
2. ä¼ è¾“é¡¹ç›®æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨
3. åœ¨è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œéƒ¨ç½²è„šæœ¬

### å¦‚æœéœ€è¦æ„å»ºé•œåƒ

```bash
cd claude-relay-service
./build.sh
./export-images.sh
```

## é¡¹ç›®çŠ¶æ€

âœ… **å·²å®Œæˆæ‰€æœ‰ä»»åŠ¡**:
- Docker é…ç½®ä¼˜åŒ–
- é•œåƒæ„å»ºå’Œåˆ†å·è„šæœ¬
- éƒ¨ç½²ç®¡ç†è„šæœ¬ï¼ˆå¤šå¹³å°ï¼‰
- å®Œæ•´æ–‡æ¡£ç¼–å†™
- æ•°æ®æŒä¹…åŒ–é…ç½®

ğŸ“¦ **é¡¹ç›®å¯ä»¥ç›´æ¥ä½¿ç”¨**:
- æ‰€æœ‰è„šæœ¬å·²åˆ›å»ºå¹¶æ·»åŠ æ‰§è¡Œæƒé™
- æ–‡æ¡£å®Œæ•´ï¼Œæ¶µç›–æ‰€æœ‰åœºæ™¯
- æ”¯æŒç¦»çº¿å†…ç½‘éƒ¨ç½²

ğŸš€ **å‡†å¤‡å°±ç»ª**:
- å¯ä»¥ç«‹å³å¼€å§‹éƒ¨ç½²æµ‹è¯•
- å¯ä»¥æäº¤åˆ° Git è¿›è¡Œç‰ˆæœ¬ç®¡ç†
- å¯ä»¥åˆ†å‘ç»™å›¢é˜Ÿä½¿ç”¨

---

**åˆ›å»ºæ—¶é—´**: 2025-01-12
**é¡¹ç›®è·¯å¾„**: e:\claudecode\github002\claude-relay-service\
